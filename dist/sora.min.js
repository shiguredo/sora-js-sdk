/*!
 * sora-js-sdk
 * WebRTC SFU Sora Signaling Library
 * @version 0.5.0
 * @author Shiguredo Inc.
 * @license Apache License 2.0
 */
!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.Sora=e()}}(function(){return function e(n,t,o){function i(a,s){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=t[a]={exports:{}};n[a][0].call(u.exports,function(e){var t=n[a][1][e];return i(t?t:e)},u,u.exports,e,n,t,o)}return t[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),r=function(){function e(n){o(this,e),this.url=n||""}return i(e,[{key:"connection",value:function(){return new a(this.url)}}]),e}(),a=function(){function e(n){o(this,e),this._ws=null,this._url=n,this._callbacks={error:function(){},disconnect:function(){},snapshot:function(){},update:function(){}}}return i(e,[{key:"_isPlanB",value:function(){var e=window.navigator.userAgent.toLocaleLowerCase();return e.indexOf("chrome")!=-1}},{key:"_createSignalingMessage",value:function(e){var n={type:"connect",role:e.role,channel_id:e.channelId,access_token:e.accessToken};Object.keys(n).forEach(function(e){void 0===n[e]&&(n[e]=null)}),e.multistream===!0&&(n.multistream=!0,n.plan_b=this._isPlanB());var t=!0;"audio"in e&&"boolean"==typeof e.audio&&(t=e.audio),t&&"audioCodecType"in e&&(t={codec_type:e.audioCodecType}),n.audio=t;var o=!0;return"video"in e&&(o=e.video),o&&!function(){var n=["videoCodecType","videoBitRate","videoSnapshot"];Object.keys(e).some(function(e){return 0<=n.indexOf(e)})&&(o={},"videoCodecType"in e&&(o.codec_type=e.videoCodecType),"videoBitRate"in e&&(o.bit_rate=e.videoBitRate),"videoSnapshot"in e&&(o.snapshot=e.videoSnapshot))}(),n.video=o,n}},{key:"connect",value:function(e){var n=this;return new Promise(function(t,o){null===n._ws&&(n._ws=new WebSocket(n._url)),n._ws.onopen=function(){n._ws.send(JSON.stringify(n._createSignalingMessage(e)))},n._ws.onclose=function(e){/440\d$/.test(e.code)?o(e):n._callbacks.disconnect(e)},n._ws.onerror=function(e){n._callbacks.error(e)},n._ws.onmessage=function(e){var o=JSON.parse(e.data);"offer"===o.type?t(o):"update"===o.type?n._callbacks.update(o):"snapshot"===o.type?n._callbacks.snapshot(o):"ping"===o.type&&n._ws.send(JSON.stringify({type:"pong"}))}})}},{key:"answer",value:function(e){this._ws.send(JSON.stringify({type:"answer",sdp:e}))}},{key:"candidate",value:function(e){var n=e.toJSON();n.type="candidate",this._ws.send(JSON.stringify(n))}},{key:"disconnect",value:function(){this._ws&&(this._ws.close(),this._ws=null)}},{key:"on",value:function(e,n){this._callbacks.hasOwnProperty(e)&&(this._callbacks[e]=n)}}]),e}();n.exports=r},{}]},{},[1])(1)});